# SQL

SQL语言是S为操作数据库而开发的语言,它的规范称为[ANSI-SQL](https://baike.baidu.com/item/ANSI%20SQL/5083565?fr=aladdin),但实时上由于不同数据库的实现不同,几乎没有一款数据库是完全符合这个标准的,因此几乎没法一点不改的将一种数据库使用的sql语句迁移到另一种数据库上使用,但好在基本上语法是相通的,因此这边才能写这部分内容.

虽然为了应付一些特殊需求有越来越多的nosql数据库出现了,但关系数据库因为其成熟通用依然是各行各业的基石.而关系数据库通用的SQL语言依然是做数据的基础.

## 数据库和数据库管理系统

将数据保存起来通过计算机加工而成的可以进行高效访问的数据集合称为数据库(Database,DB).用来管理数据库的计算机系统称为数据库管理系统(Database Management System,DBMS)

数据库一般按存储模型和存储介质来做区分,比如Key-value数据库通常用键值对保存数据,将数据保存在内存种的数据库叫内存数据库.而数据库管理系统则是数据库的交互层,负责将操作者的意图转化为具体操作在数据库上执行.SQL语言就是执行在这个交互层上的编程语言.

## 关系数据库管理系统

关系数据库是现在应用最广泛的数据库.使用行列组成的二维表来管理数据,表与表间以关系建立联系,因此称为关系模型.SQL语言也是关系数据库的专用操作语言

## 关系数据库管理系统种的基本结构

### 数据库

### Schema

数据库业界对于`schema`有多种译法:纲要,模式,方案等等.但各种译法都不能准确直观地表达出其原本的含义--即位于一个独立命名空间内的一组相关数据库对象的集合.

ANSI SQL标准中对`schema`有着明确的定义--`database`的下一层逻辑结构就是`schema`.

如果把database比作一个国家,那么schema 就是一些独立的省,大多数对象是隶属于某个schema的,然后schema又隶属于某个database.


### 表

用于存储数据的二维表就是表.表是一类同构数据的集合

### 行

表中的一行表示一条数据.这条数据会以多个维度来描述一个东西.

### 列

表中的一列表示所有数据种特定维度的集合.

### 数据类型

数据类型描述数据特定维度的类型约束,比如年龄的类型一般是int4

### 约束

用于描述数据特定维度一些特殊限制条件的规则就是约束.常见的有主键约束,唯一约束,非空约束等

### 索引

用于快速查找数据的结构


### 结构间的关系

打一个这样的比喻:

+ 数据库 => 一个仓库

+ schema => 仓库下的一个房间

+ 表 => 房间里的储物柜

+ 列 => 储物柜里的列

+ 行 => 储物柜里的行

+ data => 就是存储在储物柜里面的物品了

+ 数据类型 => 物品的类别标签

+ 约束 => 准许存放物品的规则

+ 索引 => 物品存放位置的目录


## SQL语言的操作目的

SQL根据操作目的可以分为三种:

+ DDL(Data Definition Language,数据定义语言)
+ DML(Data Manipulation Language,数据操纵语言)
+ DCL(Data Control Language,数据控制语言)

实际使用的SQL语句当中有90%属于DML,因此DML是sql语言的核心内容.


## SQL语言的基本规则

SQL语言是命令式语言,它不会描述数据库要怎么做,只会描述要数据库做什么.SQL语句必须满足如下几点:

### SQL基于英文

SQL语言基于英文,因此**注意使用英文字符和符号**.**单词使用空格分隔**


### SQL 语句要以分号;结尾

一条SQL语句可以描述一个数据库操作.在数据库当中SQL语句也是逐条执行的.SQL种使用`;`来辨别一条SQL语句的结束.

### SQL语句不区分大小写

SQL不区分关键字的大小写,例如不管写成`SELECT`还是`select`解释都是一样的,**表名和列名也是如此**.

通常约定俗成的我们会将关键字全部大写,表明首字母大写,其他的则都小写.

需要注意,虽然关键字和表名列名不区分大小写,但数据是区分的.


### 常数的书写方式是固定的

SQL语句常常需要直接书写字符串,日期或者数字.在SQL语句中直接书写的字符串,日期或者数字等称为常数.

数字可以直接写不需要任何标识,而字符串,日期等常数则需要使用单引号`'`标识.

### 注释的书写方式

类似其他变成语言,SQL语句中也可以有注释,被注释的部分不会被执行.SQL中有两种注释形式:

+ 单行注释使用`--`
  ```SQL
  --这是单行注释
  ```
+ 段注释使用`/* */`包裹
  ```SQL
  /*
  这是段注释
  */
  ```


## 本文的约定

+ 本文使用postgresq 11版本作为sql运行的载体,毕竟pg是对ANSI-SQL支持最好的开源数据库之一.

+ 本文使用[postgres_kernel](https://github.com/bgschiller/postgres_kernel)作为客户端执行例子

+ 本文使用[docker](https://www.docker.com/)部署postgresq,使用默认库`postgres`作为样例库.部署的[docker-compose](https://docs.docker.com/compose/)文件如下:

    ```yml
    version: '3.6'
    services:
      postgres:
        image: postgres:11
        logging:
          options:
            max-size: "10m"
            max-file: "3"
        ports:
          - 5432:5432
        environment:
          POSTGRES_PASSWORD: "postgres"
    ```
    
+ 本文每篇文章都会单独建表,不会存在需要上下文环境的情况,因此在一些章节中会有大段的建表录入数据的操作代码,可能影响阅读流畅性,还请见谅

连接数据库使用如下命令


```PostgreSQL
-- connection: postgres://postgres:postgres@localhost:5432/postgres
```


```PostgreSQL
-- autocommit: true
```

    switched autocommit mode to True
